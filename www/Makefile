# This builds the dependent parts of the website files.  It's a bit of
# a kluge at the moment; it really ought to be generated by autoconf, in
# case xmlto is not available but xsltproc is.

%.html: ../%.xml
	xmlto xhtml-nochunks $<

XML = \
	gpsd.xml \
	gps.xml \
	libgps.xml \
	libgpsmm.xml \
	libgpsd.xml \
	gpsmon.xml \
	gpsdecode.xml \
	gpsprof.xml \
	gpsfake.xml \
	gpsctl.xml \
	gpscat.xml \
	gpspipe.xml \
	rtcm-104.xml \
	srec.xml

all: html

html: index.html hardware.html writing-a-driver.html gypsy.html AIVDM.html NMEA.html $(XML:.xml=.html) protocol-evolution.html protocol-transition.html

AIVDM.html: AIVDM.txt
	asciidoc -a toc AIVDM.txt

NMEA.html: NMEA.txt
	asciidoc -a toc NMEA.txt

protocol-evolution.html: protocol-evolution.txt
	asciidoc -a toc protocol-evolution.txt

protocol-transition.html: protocol-transition.txt
	asciidoc -a toc protocol-transition.txt

writing-a-driver.html: writing-a-driver.xml
	xmlto xhtml-nochunks writing-a-driver.xml

index.html: index.html.in
	sed -e "/@DATE@/s//`date '+%B %d, %Y'`/" <index.html.in >index.html

hardware.html: hardware-head.html ../gpscap.ini hardware-tail.html
	(cat hardware-head.html; (cd ..; python gpscap.py); cat hardware-tail.html) >hardware.html

clean:
	rm -f $(XML:.xml=.html) hardware.html protocol-evolution.html protocol-transition.html writing-a-driver.html *~
