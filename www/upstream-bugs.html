<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
  <meta http-equiv="Content-Type"
 content="text/html; charset=iso-8859-1">
  <meta name="Author" content="Eric Raymond">
  <meta name="Keywords" content="GPS, translator, mxmap, GIS">
  <title>Bugs GPSD Exposes In Other Software</title>
  <link rel="stylesheet" href="main.css" type="text/css">
</head>
<body>
<div id="Header">Bugs GPSD Exposes In Other Software</div>
<div id="Menu"> <img src="gpsd-logo-small.png"><br>
<a href="index.html">Home</a><br>
<a href="index.html#news">News</a><br>
<a href="index.html#downloads">Downloads</a><br>
<a href="index.html#mailing-lists">Mailing lists</a><br>
<a href="index.html#documentation">Documentation</a><br>
<a href="faq.html">FAQ</a><br>
<a href="xgps-sample.html">Screenshots</a><br>
<a href="index.html#recipes">Recipes</a><br>
<a href="index.html#others">Other GPSDs</a><br>
<a href="hardware.html">Hardware</a><br>
<a href="for-vendors.html">For GPS Vendors</a><br>
<a href="hall-of-shame.html">Hall of Shame</a><br>
<a href="hacking.html">Hacker's Guide</a><br>
<a href="references.html">References</a><br>
<a href="history.html">History</a><br>
Wish List<br>
<div>&nbsp;</div>
<a href="http://www.catb.org/hacker-emblem/"><img
 src="http://www.catb.org/hacker-emblem/glider.png" alt="hacker emblem"></a><br>
<hr>
<script type="text/javascript"><!--
    google_ad_client = "pub-1458586455084261";
    google_ad_width = 160;
    google_ad_height = 600;
    google_ad_format = "160x600_as";
    google_ad_type = "text";
    google_ad_channel = "";
    //--></script>
<script type="text/javascript"
 src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
    </script>
<hr> <a href="http://validator.w3.org/check/referer"><img
 src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0!"
 height="31" width="88"></a>
</div>
<div id="Content">

<p>This page used to be part of the to-do list in our source
distribution, until we realized it would be useful for the rest of the
Web to see these bug reports.  Where we can identify a responsible
maintainer, we've tried to kick these upstream.</p>

<h1>Links to Open User-Visible Problems</h1>

<ul>
<li><a href="#bluetooth">Firmware problems in some Bluetooth and USB devices can hang them</a></li>
<li><a href="#pl2303">Linux pl2303 driver on openwrt 2.4 kernel can hang when device is read at unexpected speed</a></li>
<li><a href="#pthread_create">pthread_create() fails to return when called in background</a></li>
</ul>

<h1>Links to Open Toolchain Bugs</h1>

<ul>
<li><a href="#libtool">Multiple definitions of symbol _gpsd_report due to libtool bug</a></li>
<li><a href="#macxlibs">Mac OS 10.5 X library packaging problem</a></li>
<li><a href="#pyinstall">Defective Python installation in SuSE 10.3rc</a></li>
</ul>

<h1>Links to Fixed Bugs</h1>

<ul>
<li><a href="#startup">Distro-dependent problems with gpsd startup</a></li>
<li><a href="#select">Buggy pl2303 drivers on Maxc OS X can make select(2) look broken</a></li>
<li><a href="#openmotif">The 2.3.0-beta version of OpenMotif shipped
with Fedora Core 5 was buggy.</a></li>
<li><a href="#pysocket">Python socket library barfs on IPV6 notation in the /etc/hosts file</a></li>
<li><a href="#isgps">isgps.c triggers an optimizer bug in older gcc versions</a></li>
<li><a href="#fc5_64bit">gpsd build may break on 64-bit systems running Fedora Core 5</a></li>
<li><a href="floats">Incorrect generation of floating-point code in embedded toolchains</a>
</ul>

<hr/>

<h1>Open User-Visible Problems</h1>

<h2 id="bluetooth">Firmware problems in some Bluetooth and USB devices can hang them</h2>

<p>The baudrate-hunting code in <code>gpsd</code> tickles a serious
firmware bug on some some Bluetooth devices, notably those shipped by
Holux and including the GPSlim-236.  This bug may render these GPSes
catatonic.  The problem seems to be that buggy firmware inside these
receivers doesn't necessarily keep the Bluetooth serial-port emulation
and the GPS chip talking at the same baud rate. This problem is not
unique to <code>gpsd</code> - windows users are warned against using
SiRFdemo's "Synchronize Protocol/Baud Rate" option on bluetooth devices.</p>

<p>If this happens, you can sometimes recover by repeatedly sending
reset messages using <code>gpsctl</p>.  The only guaranteed fix is to
drain the battery backing up the GPS's settings; in extreme cases, you
may have to open the case and unsolder the backup battery so the chip
forgets its configuration settings.</p>

<p>A separate bug with less severe symptoms afflicts some USB devices.
The probe strings <tt>gpsd</tt> sends in orderv to determuine device
type and subtype may be more than a device can handle, causing it to
hang; power-cycling should fix this.  Newer versions of <tt>gpsd</tt>
break up the probe writes into smaller pieces, interleaving them with
the first few packet reads, so they are far less likely to ttrigger
this bug.</p>

<p>Use the -b option of gpsd to prevent it from trying to reconfigure
your GPS; this will avoid both problems.</p>

<h2 id="pl2303">Linux pl2303 driver on openwrt 2.4 kernel can hang when device is read at unexpected speed</h2>

<p>Michael R. Davis reports "If you read from the device at the wrong
rate (e.g. cat /dev/xxx) it will lock up.  On openwrt it required a
hard reboot." Details <a
href='http://marc.info/?l=gpsd-dev&m=115940539029940&w=2'>here</a>. This
bug was reported in 2006 with an old kernel version and may since have
been fixed.</p>

<h2 id="pthread_create">pthread_create() fails to return when called in background</h2>

There is a call to pthread create in libgpsd_core.c::link_activate():

<listing>
    /*@i1@*/(void)pthread_create(&amp;pt,NULL,gpsd_ppsmonitor,(void *)session);
</listing>

<p>If this is called when gpsd is in the foreground then the thread is
created fine and pthread_create() returns right away.  If this is
called when gpsd is in the background then the thread is created fine,
but it may return!  That freezes the main loop of gpsd. There is a <a
href="http://marc.info/?l=gpsd-dev&m=120124952704634&w=2">workaround</a>,
but the nature of the workaround only makes ther bug more mysterious.</p>

<h1>Open Toolchain Bugs</h1>

<p><code>gpsd</code> is distressingly good at tickling bugs in
development toolchains.  Most of these, thankfully, are non-issues
if you keep your toolchain up to date.</p>

<h2 id="libtool">Multiple definitions of symbol _gpsd_report due to libtool bug</h2>

<p>Some people building gpsd get 'multiple definitions of symbol
_gpsd_report' as a warning.  This seems to be a result of two bugs in
libtool, one of which masks the other on i386. gpsd_report() is indeed
multiply defined, the problem is that libtool generates libgps.o where
it should generate -lgps and <em>all</em> instances (rather than just
the first to be incorporated by other linkage demands) are linked
in.</p>

<h2 id="macxlibs">Mac OS 10.5 X library packaging problem</h2>

<p>Building <code>xgpsspeed</code> will fail under MacOS 10.5.6
because the X SDK libraries and include files are not installed to
the canonical places.  The workaround is to configure like this:</p>

<pre>
configure \
    --x-includes=/Developer/SDKs/MacOSX10.5.sdk/usr/X11R6/include \
    --x-libraries=/Developer/SDKs/MacOSX10.5.sdk/usr/X11R6/lib
</pre>

<p>We haven't attempted to embed this in our autotools build because
it looks like the fix would have to change every time the OS version
number is incremented.</p>

<h2 id="pyinstall">Defective Python installation in SuSE 10.3rc</h2>

<p>The Python 2.5 installed with SuSE 10.3rc is missing a needed
Makefile.  This prevents the <code>gpsd</code> Python components from
building correctly.</p>

<h1>Fixed Problems</h1>

<p>We document these here in case you're running on an older system.
They will be removed as they bwcome sufficiently ancient.</p>

<h2 id="startup">Distro-dependent problems with gpsd startup</h2>

<p>See <a href='http://bugs.gentoo.org/show_bug.cgi?id=132288'>this
Gentoo bug</a>.  This shows up on other distributions as well, but
not under Fedora Core.  The Gentoo problem can be fixed by creating a
/var/run/usb directory; this fix may apply to other distributions as
well.</p>

<h2 id="select">Buggy pl2303 drivers on Maxc OS X can make select(2) look broken</h2>

<p>When the fd set being polled includes tty devices (as opposed to
sockets), select(2) can return 0 and shows no fd with input waiting
even when data is in fact ready to be read from some of the devices.</p>

<p>The most recent incarnation of this problem was due to a buggy pl2303
USB-to-serial driver. OS X users should ensure that all their drivers are
up to date. As of January 2009, this is still a problem - the most recent
report being a failure of the drivers from osx-pl2303.sourceforge.net on
OS X 10.5.6. Please try the latest drivers from www.prolific.com.tw before
reporting hangs on OS X.</p>

<h2 id="openmotif">The 2.3.0-beta version of OpenMotif shipped with
Fedora Core 5 was buggy.</h2>

<p>xgps tickles a bug, described at http://bugs.motifzone.net/ as bugs
1330 and 1331 and marked FIXED, in some versions of OpenMotif.  The
symptom is that the satellite-data window in xgps is too small.  Avoid
by either upgrading to 2.3.0-0.1.9.3 (or later) or dropping back to a
stable version like 2.2.2.  Alternatively, remove OpenMotif and
install lesstif. For gpsd's purposes, lesstif is a completely
compatible drop-in replacement.</p>

<h2 id="pysocket">Python socket library barfs on IPV6 notation in the /etc/hosts file</h2>

<p>Robert J.Berger <rberger@ibd.com> reports:
Until I changed the line in /etc/hosts from:</p>

<pre class='code'>
::1    localhost.localdomain   localhost
</pre>

to:<br/>

<pre class='code'>
127.0.0.1       localhost.localdomain   localhost
</pre>

<p>gps.py would fail when trying to open the socket connection to the gpsd:</p>

<pre class='code'>
   File "/usr/local/bin/spGps.py", line 198, in __init__
     self.connect(host, port)
   File "/usr/local/bin/spGps.py", line 237, in connect
     raise socket.error, msg
socket.error: (111, 'Connection refused')
</pre>

<p>and gpsprof would fail with:</p>

<pre class='code'>
# gpsprof | gnuplot -persist
gpsprof: gpsd unreachable.
</pre>

<p>This is with Python 2.4.4 under Red Hat Linux, kernel version 2.6.18.
This was filed upstream as Python bug 1603527 on trheir old tracker, and
is no longer open on their new one.</p>

<h2 id="isgps">isgps.c triggers an optimizer bug in older gcc versions</h2>

<p>The isgps.c file confuses the gcc-3.4.[23] optimizer at -O2 level,
making it generate incorrect code.  Removing -O2 from the
compilation flags works around the problem.  Details are in the
isgps.c source file.</p>

<p>Compiling with --enable-max-devices=1 may trigger a gcc
optimizer bug</p>

<p>At gpsd revision level 3365, compiling with
--enable-max-devices=1 has been observed to trigger an
optimizer bug in gcc 4.1.0 20060304 (Red Hat 4.1.0-3).  The symptom is
a for-loop termination condition not causing an exit, leading to a
core dump.  Removing -O2 from the compilation flags works around the
problem; upgrading to gcc 4.1.1 20060525 (Red Hat 4.1.1-1) solves it.
Other reports indicate this bug was introduced sometime after gcc
4.0.2 20051125 (Red Hat 4.0.2-8).</p>

<h2 id="fc5_64bit">gpsd build may break on 64-bit systems running Fedora Core 5</h2>

<p>The problem may be be caused by the old ld (binutils-2.15.92.0.2-18)
being incompatible with gcc 4.1.0 on a 64-bit system. Updating to
binutils 2.16.1 or later avoids it.</p>

<h2 id="floats">Incorrect generation of floating-point code in embedded toolchains</h2>

<p>One problem area is errors in generation of floating-point code.  A
number of trouble reports have been received indicating erroneous
results on embedded platforms, most notably ARM systems. These have
all been traced back to the toolchain; when appropriate corrective
action was taken, <code>gpsd</code> functioned correctly. Source code
for a simple test program (<code>floattest.c</code>) is in the
Subversion repository; if <code>gpsd</code> seems to be producing
incorrect output, please use this tool to validate your toolchain
before filing a bug report.</p>

<p>&nbsp;</p>

<div style="text-align: center;">
<span>Search for GPS-related information here:</span>
<!-- SiteSearch Google -->
<form method="get" action="http://www.google.com/custom" target="_top">
  <table bgcolor="#ffffff" border="0">
    <tbody>
      <tr>
        <td align="left" height="32" nowrap="nowrap" valign="top"><a
 href="http://www.google.com/"> <img
 src="http://www.google.com/logos/Logo_25wht.gif" alt="Google"
 align="middle" border="0"></a></td>
        <td nowrap="nowrap"> <input name="domains"
 value="gpsd.berlios.de" type="hidden"><input name="q" size="31"
 maxlength="255" value="" type="text"> <input name="sa" value="Search"
 type="submit"></td>
      </tr>
      <tr>
        <td>&nbsp;</td>
        <td nowrap="nowrap">
        <table>
          <tbody>
            <tr>
              <td> <input name="sitesearch" value="" type="radio"><font
 color="#000000" size="-1">Web</font> </td>
              <td> <input name="sitesearch" value="gpsd.berlios.de"
 checked="checked" type="radio"><font color="#000000" size="-1">gpsd.berlios.de</font>
              </td>
            </tr>
          </tbody>
        </table>
        <input name="client" value="pub-1458586455084261" type="hidden">
        <input name="forid" value="1" type="hidden"><input name="ie"
 value="ISO-8859-1" type="hidden"> <input name="oe" value="ISO-8859-1"
 type="hidden"><input name="flav" value="0000" type="hidden"> <input
 name="sig" value="BCQudoNGuH3P6MJe" type="hidden"><input name="cof"
 value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:336699;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;FORID:1"
 type="hidden"> <input name="hl" value="en" type="hidden"></td>
      </tr>
    </tbody>
  </table>
</form>
<!-- SiteSearch Google -->
</div>
</div>

<hr>
<script language="JavaScript" src="datestamp.js" type="text/javascript"></script><!--
Local Variables:
compile-command: "(scp upstream-bugs.html shell.berlios.de:/home/groups/gpsd/htdocs)"
End:
-->
</body>
</html>
